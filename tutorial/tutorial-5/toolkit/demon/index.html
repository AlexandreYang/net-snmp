<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>NET-SNMP Tutorial -- Demon</title>
  </head>

  <body bgcolor="#ffffff" background="/ucd-snmp-bg3.gif">
    <center><h1>NET-SNMP Tutorial -- Demon</h1></center>
<hr>
    <h1>*** WARNING WARNING WARNING ***</h1>
    <p>
      <b>The AgentX support in the net-snmp package is still beta
      level quality.  Although many people have used it successfully,
      we're not confident enough yet to say that its bug free (and in
      fact we know its not in areas).  Use at your own risk.</b>
    <h1>Sub-Agent Demon tutorial</h1>
    <p>
      First off, you need to write a mib module first before you can
      do this part of the tutorial.  We assume you have read and
      completed the <a href="../mib_module/index.html">mib module
      portion</a> of the toolkit tutorial and have code you now wish
      to compile into a subagent.
    <p>
      There are two ways to compile a mib module into a subagent.
      You can do it yourself, described in detail below, or you can
      take your mib module and attempt to make a quick-and-dirty
      subagent automatically using the net-snmp-config script (here we
      assume that XXX.c contains your subagent code)x:
    <ul>
	% <b> net-snmp-config --compile-subagent mysubagent XXX.c
    </ul>
    <p>
      If all goes well, this should have produced a <b>mysubagent</b>
      binary file.  You can then start the snmpd master agent and then
      start your subagent and hopefully get at the results using the
      <a href="/tutorial-5/commands/">various snmp commands</a>.
    <h2>Instrumenting your own code with agentx subagent support</h2>
    <p>
      It's probably more likely that you want to compile in your new
      code into a previously existing application, and the
      auto-building of the subagent using the net-snmp-config command
      isn't appropriate.
    <p>
      Lets take the previous example and implement it in our own
      process which attaches to the master agent using the AgentX
      protocol.  This is easier than you might think, as we provide
      libraries to do the work for you and additionally the mib module
      code that <a href="../mib_module/index.html">you previously
      wrote</a> does not have to change at all.  We merely compile it
      ourselves this time, outside the main net-snmp package and put a
      main() wrapper around it.
    <p>
      First, the files you'll need:
      <center><table border=1>
	<tr bgcolor="#d0d0ff"><th>File</th><th>Description</th></tr>
	<tr bgcolor="#d0d0ff"><td><a
	href="../demoapp/Makefile">Makefile</a></td><td>A simple makefile 
	used to build the projects</td>
	<tr bgcolor="#d0d0ff"><td><a
	href="ustMain.c">ustMain.c</a></td><td>The
	main() code for our demon</td></tr>
      </table></center>
    <p>
      First, fire up the master agent.  In your snmpd.conf file you
      must put a line that says "master agentx" to turn on the master
      agent support.
    <p>
      Once the agent is started, we can build and attach our own to
      it.
    <p>
      To do so, compile the ustMain program using the Makefile found
      above.  Note that to compile it, the Makefile uses the
      net-snmp-config command to generate a list of needed
      compilation flags and compilation libraries.  You might run the
      following commands in a shell to see what type of output they
      provide:
    <p>
    <ul>
      <li> net-snmp-config --cflags
      <li> net-snmp-config --agent-libs
    </ul>
    <p>
      Type <b>make</b> to compile our test subagent:
    <p>
      <pre>
% <b>make</b>
cc `net-snmp-config --cflags` -c ustMain.c -o ustMain.o
cc `net-snmp-config --cflags` -c XXX.c -o XXX.o
cc -o ustMain ustMain.o XXX.o `net-snmp-config --agent-libs`
    </pre>
    <p>
      You should then be able to run your new program (<b>ustMain</b>)
      and access the data housed within it.  A good test is to do is
      to ensure that you can't access your data before starting it, and
      that you can after starting it.
    <h2>Debugging</h2>
    <p>
      If you're having problems, it's helpful to pass -Dagentx on the
      command line to the snmpd master agent to get it to spew out a
      bunch of debugging information about it's agentx transactions.
    <hr>
    <address><a href="mailto:Wes Hardaker <hardaker@users.sourceforge.net>"></a></address>
<!-- Created: Fri Nov  5 14:28:37 PST 1999 -->
<!-- hhmts start -->
Last modified: Tue Apr 23 17:43:39 PDT 2002
<!-- hhmts end -->
  </body>
</html>
