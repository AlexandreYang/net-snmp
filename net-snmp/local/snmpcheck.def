#!/usr/local/bin/perl

$mibident=".2";
$miberrflag=".100";
$miberrmsg=".101";
$mibheadsht=".1.3.6.1.4";
$mibheadall="$mibheadsht.10";
@miblist=(".1",".3",".6");

$host = $ARGV[0];

foreach $mibx ( @miblist ) {
    open(OUT,"snmpwalk -v 1 $host public $mibheadall$mibx$miberrflag|");
    while (<OUT>) {
	($result) = /= ([0-9]+)/;
	if ($result > 0) {
	    ($mibloc) = /\.([0-9]+) /;
	    $_ = `snmpget -v 1 $host public $mibheadall$mibx$mibident.$mibloc`;
	    ($name) = /\"([^\"]*)\"/;
	    $_ = `snmpget -v 1 $host public $mibheadall$mibx$miberrmsg.$mibloc`;
	    ($errmsg) = /\"([^\"]*)\"/;
	    printf("$host $name: $result -- $errmsg\n");
	}
    }
    close(OUT);
} 



