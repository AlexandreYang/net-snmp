SHELL = /bin/sh
srcdir = @srcdir@
VPATH = @srcdir@
@SET_MAKE@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = $(exec_prefix)/bin
libdir = $(exec_prefix)/lib
snmplibdir = $(prefix)/lib/snmp

SED = @SED@

INSTALL = @INSTALL@
CPP = @CPP@ -I. -DDONT_INC_STRUCTS -DBINDIR=$(bindir)
CFLAGS = @CFLAGS@

TARG = bin/snmpget bin/snmpgetnext bin/snmpset bin/snmptranslate bin/snmpwalk bin/snmpbulkwalk bin/snmptest bin/snmptrapd bin/snmpnetstat bin/snmpd

SUBDIRS = snmplib agent apps local
INSTALLDIRS = $(SUBDIRS) man local

all:	mib.txt sedscript subdirs

sedscript: sedscript.in config.h agent/extensible/mibdefs.h
	$(CPP) sedscript.in | sed 's/REMOVEME//g' > sedscript

subdirs:
	for i in $(SUBDIRS) ; do \
        ( cd $$i ; $(MAKE) ) \
	done

distall: ${srcdir}/configure ${srcdir}/config.h 

install:    subdirs installdirs
	for i in $(INSTALLDIRS) ; do \
        ( cd $$i ; $(MAKE) install ) \
	done
	@$(INSTALL) mib.txt $(snmplibdir) ; echo "install:  installed mib.txt in $(snmplibdir)"

installdirs:
	@$(SHELL) $(srcdir)/mkinstalldirs $(snmplibdir)


apps/snmpget apps/snmpgetnext apps/snmpset apps/snmptranslate apps/snmpwalk apps/snmpbulkwalk apps/snmptest apps/snmptrapd apps/snmpnetstat/snmpnetstat agent/snmpd: makeall

depend:
	cd snmplib; make depend
	cd apps; make depend
	cd agent; make depend

clean:
	cd snmplib; make clean
	cd apps; make clean
	cd apps/snmpnetstat; make clean
	cd agent; make clean
	cd snmptcl; make clean
	rm -f mib.txt

distclean: clean configclean

configclean:
	rm -f config.cache config.status
	rm -f snmplib/Makefile Makefile snmptcl/Makefile agent/Makefile apps/Makefile apps/snmpnetstat/Makefile agent/extensible/Makefile

${srcdir}/configure: configure.in aclocal.m4
	cd ${srcdir} && autoconf
	echo "Please run configure now."
	sh -c exit 2

# autoheader might not change config.h.in, so touch a stamp file.
${srcdir}/config.h.in: ${srcdir}/stamp-h.in
${srcdir}/stamp-h.in: configure.in acconfig.h
	cd ${srcdir} && autoheader
	echo timestamp > ${srcdir}/stamp-h.in

config.h: stamp-h
stamp-h: config.h.in config.status
	./config.status
	echo timestamp > ${srcdir}/stamp-h

Makefile: Makefile.in config.status
	./config.status

config.status: configure
	./config.status --recheck

mib.txt: ece-mib.def mibII.txt sedscript
	cat ece-mib.def | $(SED) -f sedscript | cat mibII.txt - > mib.txt
