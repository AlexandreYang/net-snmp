SHELL = /bin/sh
srcdir = @srcdir@
VPATH = @srcdir@
@SET_MAKE@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = $(exec_prefix)/bin
libdir = $(exec_prefix)/lib
snmplibdir = $(prefix)/lib/snmp

# @target_cpu@ @target_vendor@ @target_os@

INSTALL = @INSTALL@

TARG = bin/snmpget bin/snmpgetnext bin/snmpset bin/snmptranslate bin/snmpwalk bin/snmpbulkwalk bin/snmptest bin/snmptrapd bin/snmpnetstat bin/snmpd

SUBDIRS = snmplib agent apps

all:	subdirs mib.txt

subdirs:
	for i in $(SUBDIRS) ; do \
        ( cd $$i ; $(MAKE) ) \
	done

distall: ${srcdir}/configure ${srcdir}/config.h 

install:    subdirs apps/snmpget apps/snmpgetnext apps/snmpset apps/snmptranslate apps/snmpwalk apps/snmpbulkwalk apps/snmptest apps/snmptrapd apps/snmpnetstat/snmpnetstat agent/snmpd
	$(INSTALL) apps/snmpget $(bindir)/snmpget
	$(INSTALL) apps/snmpgetnext $(bindir)/snmpgetnext
	$(INSTALL) apps/snmpset $(bindir)/snmpset
	$(INSTALL) apps/snmptranslate $(bindir)/snmptranslate
	$(INSTALL) apps/snmpwalk $(bindir)/snmpwalk
	$(INSTALL) apps/snmpbulkwalk $(bindir)/snmpwalk
	$(INSTALL) apps/snmptest $(bindir)/snmptest
	$(INSTALL) apps/snmptrapd $(bindir)/snmptrapd
	$(INSTALL) apps/snmpnetstat/snmpnetstat $(bindir)/snmpnetstat
	$(INSTALL) agent/snmpd $(bindir)/snmpd
#	$(INSTALL) snmptcl/wish $(bindir)/wish
	$(INSTALL) snmptcl/snmpgraph $(bindir)/snmpgraph

apps/snmpget apps/snmpgetnext apps/snmpset apps/snmptranslate apps/snmpwalk apps/snmpbulkwalk apps/snmptest apps/snmptrapd apps/snmpnetstat/snmpnetstat agent/snmpd: makeall

makeall:
	cd snmplib; make all install
	cd agent; make all
	cd apps; make
	cd apps/snmpnetstat; make

solaris:
	cd snmplib; make OSFLAGS="-DSVR4" all install
	cd apps; make OSFLAGS="-DSVR4" LDFLAGS="-lnsl -lsocket -lelf"
	cd apps/snmpnetstat; make OSFLAGS="-DSVR4" LDFLAGS="-lnsl -lsocket -lelf"
#	cd agent; make OSFLAGS="-DSVR4" LDFLAGS="-lnsl -lsocket -lelf" all

depend:
	cd snmplib; make depend
	cd apps; make depend
	cd agent; make depend

clean:
	cd snmplib; make clean
	cd apps; make clean
	cd apps/snmpnetstat; make clean
	cd agent; make clean
	cd snmptcl; make clean
	rm -f mib.txt

distclean: clean configclean

configclean:
	rm -f config.cache config.status
	rm -f snmplib/Makefile Makefile snmptcl/Makefile agent/Makefile apps/Makefile apps/snmpnetstat/Makefile agent/extensible/Makefile

${srcdir}/configure: configure.in aclocal.m4
	cd ${srcdir} && autoconf
	echo "Please run configure now."
	sh -c exit 2

# autoheader might not change config.h.in, so touch a stamp file.
${srcdir}/config.h.in: ${srcdir}/stamp-h.in
${srcdir}/stamp-h.in: configure.in acconfig.h
	cd ${srcdir} && autoheader
	echo timestamp > ${srcdir}/stamp-h.in

config.h: stamp-h
stamp-h: config.h.in config.status
	./config.status
	echo timestamp > ${srcdir}/stamp-h

Makefile: Makefile.in config.status
	./config.status

config.status: configure
	./config.status --recheck

mib.txt: ece-mib.def mibII.txt
	cat mibII.txt ece-mib.def > mib.txt
