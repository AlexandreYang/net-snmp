#
# Makefile for snmpget, snmpwalk, snmpbulkwalk, snmptest, snmptranslate,
# snmptrapd, snmptable, snmpset, snmpgetnext, and other utilities.
#

top_builddir 	= ..

TARG		= snmpget$(EXEEXT) snmpgetnext$(EXEEXT) snmpset$(EXEEXT) snmpusm$(EXEEXT)			\
			snmpwalk$(EXEEXT) snmpbulkwalk$(EXEEXT) snmptable$(EXEEXT)			\
			snmptrap$(EXEEXT) snmpbulkget$(EXEEXT)				\
			snmptranslate$(EXEEXT) snmpstatus$(EXEEXT) snmpdelta$(EXEEXT) snmptest$(EXEEXT)	\
			encode_keychange$(EXEEXT) snmpdf$(EXEEXT) snmpvacm$(EXEEXT)

SBINTARG	= snmptrapd$(EXEEXT)
SUBDIRS		= snmpnetstat

USELIBS		= ../snmplib/libsnmp.$(LIB_EXTENSION)$(LIB_VERSION) 
USETRAPLIBS	= ../agent/libucdagent.$(LIB_EXTENSION)$(LIB_VERSION) ../agent/libucdmibs.$(LIB_EXTENSION)$(LIB_VERSION) ../agent/helpers/libhelpers.$(LIB_EXTENSION)$(LIB_VERSION) $(USELIBS)
LOCAL_LIBS	= -L../snmplib -L../agent -L../agent/helpers
#LIBS		= $(CC_RUNTIME_ARG) -lsnmp @LIBS@
LIBS		= $(USELIBS) @LIBS@
TRAPLIBS	= $(USETRAPLIBS) @LIBS@

CPPFLAGS	= -I.. -I$(srcdir)/.. -I$(srcdir)/../snmplib @CPPFLAGS@ \
		  -I../agent -I../agent/helpers -I../agent/mibgroup
OSUFFIX		= lo
TRAPD_OBJECTS   = snmptrapd.$(OSUFFIX) snmptrapd_handlers.$(OSUFFIX) snmptrapd_log.$(OSUFFIX) notification_log.$(OSUFFIX)

all: $(TARG) $(SBINTARG) subdirs


subdirs:
	for i in $(SUBDIRS) ; do \
        ( cd $$i ; $(MAKE) ) ; \
	done

snmpwalk$(EXEEXT):    snmpwalk.$(OSUFFIX) $(USELIBS)
	$(LINK) -o $@ snmpwalk.$(OSUFFIX) $(LOCAL_LIBS) ${LDFLAGS} ${LIBS} 

snmpbulkwalk$(EXEEXT):    snmpbulkwalk.$(OSUFFIX) $(USELIBS)
	$(LINK) -o $@ snmpbulkwalk.$(OSUFFIX) $(LOCAL_LIBS) ${LDFLAGS} ${LIBS} 

snmpbulkget$(EXEEXT):    snmpbulkget.$(OSUFFIX) $(USELIBS)
	$(LINK) -o $@ snmpbulkget.$(OSUFFIX) $(LOCAL_LIBS) ${LDFLAGS} ${LIBS} 

snmptranslate$(EXEEXT):    snmptranslate.$(OSUFFIX) $(USELIBS)
	$(LINK) -o $@ snmptranslate.$(OSUFFIX) $(LOCAL_LIBS) ${LDFLAGS} ${LIBS} 

snmpstatus$(EXEEXT):    snmpstatus.$(OSUFFIX) $(USELIBS)
	$(LINK) -o $@ snmpstatus.$(OSUFFIX) $(LOCAL_LIBS) ${LDFLAGS} ${LIBS} 

snmpget$(EXEEXT):    snmpget.$(OSUFFIX) $(USELIBS)
	$(LINK) -o $@ snmpget.$(OSUFFIX) $(LOCAL_LIBS) ${LDFLAGS} ${LIBS} 

snmpdelta$(EXEEXT):    snmpdelta.$(OSUFFIX) $(USELIBS)
	$(LINK) -o $@ snmpdelta.$(OSUFFIX) $(LOCAL_LIBS) ${LDFLAGS} ${LIBS} 

snmptable$(EXEEXT):    snmptable.$(OSUFFIX) $(USELIBS)
	$(LINK) -o $@ snmptable.$(OSUFFIX) $(LOCAL_LIBS) ${LDFLAGS} ${LIBS} 

snmptest$(EXEEXT):    snmptest.$(OSUFFIX) $(USELIBS)
	$(LINK) -o $@ snmptest.$(OSUFFIX) $(LOCAL_LIBS) ${LDFLAGS} ${LIBS} 

snmptrapd$(EXEEXT):    $(TRAPD_OBJECTS) $(USETRAPLIBS) 
	/bin/sh ../libtool --mode=link gcc -I/usr/include/rpm -g -Wall -Wstrict-prototypes -Wwrite-strings -Wcast-qual -Wno-char-subscripts -Dlinux -o snmptrapd $(TRAPD_OBJECTS) -L/usr/local/lib ../agent/libucdagent.la ../agent/libucdmibs.la ../agent/helpers/libhelpers.la ../snmplib/libsnmp.la -lcrypto -ldl -ldb1 -lz -lpopt -lm -ldmalloc
#	$(LINK) -o $@ $(TRAPD_OBJECTS) $(LOCAL_LIBS) ${LDFLAGS} ${TRAPLIBS}

snmptrap$(EXEEXT):    snmptrap.$(OSUFFIX) $(USELIBS)
	$(LINK) -o $@ snmptrap.$(OSUFFIX) $(LOCAL_LIBS) ${LDFLAGS} ${LIBS} 
	rm -f snmpinform
	$(LN_S) snmptrap snmpinform

snmpset$(EXEEXT):    snmpset.$(OSUFFIX) $(USELIBS)
	$(LINK) -o $@ snmpset.$(OSUFFIX) $(LOCAL_LIBS) ${LDFLAGS} ${LIBS} 

snmpusm$(EXEEXT):    snmpusm.$(OSUFFIX) $(USELIBS)
	$(LINK) -o $@ snmpusm.$(OSUFFIX) $(LOCAL_LIBS) ${LDFLAGS} ${LIBS} 

snmpvacm$(EXEEXT):    snmpvacm.$(OSUFFIX) $(USELIBS)
	$(LINK) -o $@ snmpvacm.$(OSUFFIX) $(LOCAL_LIBS) ${LDFLAGS} ${LIBS} 

snmpgetnext$(EXEEXT):    snmpgetnext.$(OSUFFIX) $(USELIBS)
	$(LINK) -o $@ snmpgetnext.$(OSUFFIX) $(LOCAL_LIBS) ${LDFLAGS} ${LIBS} 

encode_keychange$(EXEEXT):    encode_keychange.$(OSUFFIX) $(USELIBS)
	$(LINK) -o $@ encode_keychange.$(OSUFFIX) $(LOCAL_LIBS) ${LDFLAGS} ${LIBS} 

snmpdf$(EXEEXT):    snmpdf.$(OSUFFIX) $(USELIBS)
	$(LINK) -o $@ snmpdf.$(OSUFFIX) $(LOCAL_LIBS) ${LDFLAGS} ${LIBS} 


clean:
	rm -f core *.o *.lo *.exe $(TARG) $(SBINTARG)
	rm -f snmpinform
	rm -rf .libs
	for i in $(SUBDIRS) ; do \
	( cd $$i ; $(MAKE) clean ) ; \
	done


install: installdirs subdirs $(TARG)
	for i in $(SUBDIRS) ; do \
        ( cd $$i ; $(MAKE) install ) ; \
	done
	@$(INSTALL) $(TARG) $(bindir)
	@for i in $(TARG) ; do echo "install:  installed $$i in $(bindir)" ; done
	rm -f $(bindir)/snmpinform
	(cd $(bindir) && $(LN_S) snmptrap snmpinform)
	@$(INSTALL) $(SBINTARG) $(sbindir)
	@for i in $(SBINTARG) ; do echo "install:  installed $$i in $(sbindir)" ; done

installdirs:
	@$(SHELL) $(srcdir)/../mkinstalldirs $(snmplibdir) $(bindir) $(sbindir)


dependlocal: 
	makedepend $(CPPFLAGS) -o.lo $(srcdir)/*.c

depend: dependlocal
	for i in $(SUBDIRS) ; do \
        ( cd $$i ; $(MAKE) depend ) ; \
	done

nosysdepend: 
	for i in $(SUBDIRS) ; do \
        ( cd $$i ; $(MAKE) nosysdepend ) ; \
	done
	makedepend $(CPPFLAGS) -o.lo *.c
	perl -n -i.bak $(top_srcdir)/makenosysdepend.pl Makefile

makefileindepend: nosysdepend
	cd snmpnetstat; $(MAKE) makefileindepend; cd ..
	perl $(top_srcdir)/makefileindepend.pl

# DO NOT DELETE THIS LINE -- make depend depends on it.


encode_keychange.lo: ../config.h ../m/generic.h ../s/generic.h ../s/linux.h
encode_keychange.lo: ../snmplib/asn1.h ../snmplib/callback.h
encode_keychange.lo: ../snmplib/getopt.h ../snmplib/keytools.h
encode_keychange.lo: ../snmplib/scapi.h ../snmplib/snmp_api.h
encode_keychange.lo: ../snmplib/snmp_debug.h ../snmplib/snmpv3.h
encode_keychange.lo: ../snmplib/tools.h ../snmplib/transform_oids.h ../s/sysv.h
snmpbulkget.lo: ../config.h ../m/generic.h ../s/generic.h ../s/linux.h
snmpbulkget.lo: ../snmplib/asn1.h ../snmplib/getopt.h ../snmplib/mib.h
snmpbulkget.lo: ../snmplib/snmp_api.h ../snmplib/snmp_client.h
snmpbulkget.lo: ../snmplib/snmp.h ../snmplib/snmp_impl.h
snmpbulkget.lo: ../snmplib/snmp_parse_args.h ../snmplib/system.h ../s/sysv.h
snmpbulkwalk.lo: ../config.h ../m/generic.h ../s/generic.h ../s/linux.h
snmpbulkwalk.lo: ../snmplib/asn1.h ../snmplib/getopt.h ../snmplib/mib.h
snmpbulkwalk.lo: ../snmplib/snmp_api.h ../snmplib/snmp_client.h
snmpbulkwalk.lo: ../snmplib/snmp.h ../snmplib/snmp_impl.h
snmpbulkwalk.lo: ../snmplib/snmp_parse_args.h ../snmplib/system.h ../s/sysv.h
snmpdelta.lo: ../config.h ../m/generic.h ../s/generic.h ../s/linux.h
snmpdelta.lo: ../snmplib/asn1.h ../snmplib/default_store.h ../snmplib/getopt.h
snmpdelta.lo: ../snmplib/int64.h ../snmplib/mib.h ../snmplib/snmp_api.h
snmpdelta.lo: ../snmplib/snmp_client.h ../snmplib/snmp.h ../snmplib/snmp_impl.h
snmpdelta.lo: ../snmplib/snmp_logging.h ../snmplib/snmp_parse_args.h
snmpdelta.lo: ../snmplib/system.h ../s/sysv.h 
snmpdf.lo: ../config.h ../m/generic.h ../s/generic.h ../s/linux.h
snmpdf.lo: ../snmplib/asn1.h ../snmplib/getopt.h ../snmplib/mib.h
snmpdf.lo: ../snmplib/snmp_api.h ../snmplib/snmp_client.h
snmpdf.lo: ../snmplib/snmp_debug.h ../snmplib/snmp.h ../snmplib/snmp_impl.h
snmpdf.lo: ../snmplib/snmp_parse_args.h ../snmplib/system.h ../snmplib/tools.h
snmpdf.lo: ../s/sysv.h  
snmpgetnext.lo: ../config.h ../m/generic.h ../s/generic.h ../s/linux.h
snmpgetnext.lo: ../snmplib/asn1.h ../snmplib/default_store.h
snmpgetnext.lo: ../snmplib/getopt.h ../snmplib/mib.h ../snmplib/snmp_api.h
snmpgetnext.lo: ../snmplib/snmp_client.h ../snmplib/snmp.h
snmpgetnext.lo: ../snmplib/snmp_impl.h ../snmplib/snmp_parse_args.h
snmpgetnext.lo: ../snmplib/system.h ../s/sysv.h 
snmpget.lo: ../config.h ../m/generic.h ../s/generic.h ../s/linux.h
snmpget.lo: ../snmplib/asn1.h ../snmplib/default_store.h ../snmplib/getopt.h
snmpget.lo: ../snmplib/mib.h ../snmplib/snmp_api.h ../snmplib/snmp_client.h
snmpget.lo: ../snmplib/snmp.h ../snmplib/snmp_impl.h
snmpget.lo: ../snmplib/snmp_parse_args.h ../snmplib/system.h ../s/sysv.h
snmpset.lo: ../config.h ../m/generic.h ../s/generic.h ../s/linux.h
snmpset.lo: ../snmplib/asn1.h ../snmplib/getopt.h ../snmplib/int64.h
snmpset.lo: ../snmplib/mib.h ../snmplib/snmp_api.h ../snmplib/snmp_client.h
snmpset.lo: ../snmplib/snmp.h ../snmplib/snmp_impl.h
snmpset.lo: ../snmplib/snmp_parse_args.h ../snmplib/system.h ../s/sysv.h
snmpstatus.lo: ../config.h ../m/generic.h ../s/generic.h ../s/linux.h
snmpstatus.lo: ../snmplib/asn1.h ../snmplib/default_store.h ../snmplib/getopt.h
snmpstatus.lo: ../snmplib/mib.h ../snmplib/snmp_api.h ../snmplib/snmp_client.h
snmpstatus.lo: ../snmplib/snmp.h ../snmplib/snmp_impl.h
snmpstatus.lo: ../snmplib/snmp_parse_args.h ../snmplib/system.h
snmpstatus.lo: ../snmplib/tools.h ../s/sysv.h 
snmptable.lo: ../config.h ../m/generic.h ../s/generic.h ../s/linux.h
snmptable.lo: ../snmplib/asn1.h ../snmplib/default_store.h ../snmplib/getopt.h
snmptable.lo: ../snmplib/mib.h ../snmplib/parse.h ../snmplib/snmp_api.h
snmptable.lo: ../snmplib/snmp_client.h ../snmplib/snmp.h ../snmplib/snmp_impl.h
snmptable.lo: ../snmplib/snmp_parse_args.h ../snmplib/system.h ../s/sysv.h
snmptest.lo: ../config.h ../m/generic.h ../s/generic.h ../s/linux.h
snmptest.lo: ../snmplib/asn1.h ../snmplib/default_store.h ../snmplib/getopt.h
snmptest.lo: ../snmplib/mib.h ../snmplib/snmp_api.h ../snmplib/snmp_client.h
snmptest.lo: ../snmplib/snmp.h ../snmplib/snmp_impl.h
snmptest.lo: ../snmplib/snmp_parse_args.h ../snmplib/system.h ../s/sysv.h
snmptranslate.lo: ../config.h ../m/generic.h ../s/generic.h ../s/linux.h
snmptranslate.lo: ../snmplib/asn1.h ../snmplib/default_store.h
snmptranslate.lo: ../snmplib/getopt.h ../snmplib/mib.h ../snmplib/parse.h
snmptranslate.lo: ../snmplib/snmp_api.h ../snmplib/snmp_client.h
snmptranslate.lo: ../snmplib/snmp_debug.h ../snmplib/snmp.h
snmptranslate.lo: ../snmplib/snmp_impl.h ../snmplib/system.h ../s/sysv.h
snmptranslate.lo: ../version.h
snmptrapd_handlers.lo: ../config.h ../m/generic.h ../s/generic.h ../s/linux.h
snmptrapd_handlers.lo: ../snmplib/asn1.h ../snmplib/getopt.h ../snmplib/mib.h
snmptrapd_handlers.lo: ../snmplib/read_config.h ../snmplib/snmp_api.h
snmptrapd_handlers.lo: ../snmplib/snmp_debug.h ../s/sysv.h
snmptrapd_log.lo: ../config.h ../m/generic.h ../s/generic.h ../s/linux.h
snmptrapd_log.lo: ../snmplib/asn1.h ../snmplib/getopt.h ../snmplib/mib.h
snmptrapd_log.lo: ../snmplib/snmp_api.h ../snmplib/snmp.h
snmptrapd_log.lo: ../snmplib/snmp_impl.h ../snmplib/tools.h snmptrapd_log.h
snmptrapd_log.lo: ../s/sysv.h  
snmptrapd.lo: ../config.h ../m/generic.h ../s/generic.h ../s/linux.h
snmptrapd.lo: ../snmplib/asn1.h ../snmplib/callback.h
snmptrapd.lo: ../snmplib/default_store.h ../snmplib/getopt.h
snmptrapd.lo: ../snmplib/lcd_time.h ../snmplib/mib.h ../snmplib/read_config.h
snmptrapd.lo: ../snmplib/snmp_api.h ../snmplib/snmp_client.h
snmptrapd.lo: ../snmplib/snmp_debug.h ../snmplib/snmp.h ../snmplib/snmp_impl.h
snmptrapd.lo: ../snmplib/snmp_logging.h ../snmplib/snmpusm.h
snmptrapd.lo: ../snmplib/snmpv3.h ../snmplib/system.h ../snmplib/tools.h
snmptrapd.lo: ../snmplib/transform_oids.h snmptrapd_handlers.h snmptrapd_log.h
snmptrapd.lo: ../s/sysv.h  
snmptrapd.lo: ../version.h
snmptrap.lo: ../config.h ../m/generic.h ../s/generic.h ../s/linux.h
snmptrap.lo: ../snmplib/asn1.h ../snmplib/getopt.h ../snmplib/mib.h
snmptrap.lo: ../snmplib/snmp_api.h ../snmplib/snmp_client.h ../snmplib/snmp.h
snmptrap.lo: ../snmplib/snmp_impl.h ../snmplib/snmp_parse_args.h
snmptrap.lo: ../snmplib/snmpv3.h ../snmplib/system.h ../s/sysv.h
snmpusm.lo: ../config.h ../m/generic.h ../s/generic.h ../s/linux.h
snmpusm.lo: ../snmplib/asn1.h ../snmplib/default_store.h ../snmplib/getopt.h
snmpusm.lo: ../snmplib/int64.h ../snmplib/keytools.h ../snmplib/mib.h
snmpusm.lo: ../snmplib/snmp_api.h ../snmplib/snmp_client.h ../snmplib/snmp.h
snmpusm.lo: ../snmplib/snmp_impl.h ../snmplib/snmp_parse_args.h
snmpusm.lo: ../snmplib/snmp-tc.h ../snmplib/snmpv3.h ../snmplib/system.h
snmpusm.lo: ../snmplib/tools.h ../snmplib/transform_oids.h ../s/sysv.h
snmpvacm.lo: ../config.h ../m/generic.h ../s/generic.h ../s/linux.h
snmpvacm.lo: ../snmplib/asn1.h ../snmplib/default_store.h ../snmplib/getopt.h
snmpvacm.lo: ../snmplib/int64.h ../snmplib/keytools.h ../snmplib/mib.h
snmpvacm.lo: ../snmplib/snmp_api.h ../snmplib/snmp_client.h ../snmplib/snmp.h
snmpvacm.lo: ../snmplib/snmp_impl.h ../snmplib/snmp_parse_args.h
snmpvacm.lo: ../snmplib/snmp-tc.h ../snmplib/snmpv3.h ../snmplib/system.h
snmpvacm.lo: ../snmplib/tools.h ../snmplib/vacm.h ../s/sysv.h
snmpwalk.lo: ../config.h ../m/generic.h ../s/generic.h ../s/linux.h
snmpwalk.lo: ../snmplib/asn1.h ../snmplib/default_store.h ../snmplib/getopt.h
snmpwalk.lo: ../snmplib/mib.h ../snmplib/snmp_api.h ../snmplib/snmp_client.h
snmpwalk.lo: ../snmplib/snmp.h ../snmplib/snmp_impl.h
snmpwalk.lo: ../snmplib/snmp_parse_args.h ../snmplib/system.h ../s/sysv.h
