CC = cc -g

OBJS = misc.o read_config.o wes.o hpmibs.o versioninfo.o
SRCS:=$(subst .o,.c,$(OBJS))

all: TAGS $(OBJS)

TAGS: $(SRCS)
	etags *.c *.h

wes.o: wes.h wes.c struct.h mibdefs.h mibincl.h
hpmibs.o: wes.h hpmibs.c mibdefs.h mibincl.h
readconfig.o: readconfig.c struct.h
misc.o: misc.c struct.h
versioninfo.o: mibdefs.h mibincl.h wes.h tmp.make versioninfo.c
tmp.make:
	if [ -d CVS ]; then \
	perl -e 'open(X,"cvs status -v versioninfo.c|"); $$ver = "";\
        while (($$_ = <X>) && (length($$ver) < 1)) { if (/Existing Tags/)\
                              {$$_ = <X>;  ($$x,$$ver) = split;};}\
	close(X); $$curver = ""; open(X,"versioninfo.c"); open(O,">tmp.make");\
        while (($$_ = <X>) && (length($$curver) < 5)) \
	{ s/VersionInfo="(.*)"/VersionInfo="$$ver"/; print O $$_;}\
	close(X);' ;\
	mv -f tmp.make versioninfo.c ;\
	fi
