
CC = cc -g

OBJS = misc.o read_config.o extensible.o hpmibs.o proc.o exec.o versioninfo.o 
SRCS:=$(subst .o,.c,$(OBJS))

all: TAGS $(OBJS)

TAGS: $(SRCS)
	etags *.c *.h

extensible.o: ../../config.h extensible.c struct.h mibdefs.h mibincl.h
hpmibs.o: ../../config.h struct.h hpmibs.c mibdefs.h mibincl.h
read_config.o: read_config.c struct.h ../../config.h
misc.o: misc.c struct.h ../../config.h
versioninfo.o: mibdefs.h mibincl.h ../../config.h struct.h versioninfo.c
proc.o: ../../config.h struct.h mibdefs.h mibincl.h proc.c
exec.o: ../../config.h struct.h mibdefs.h mibincl.h exec.c

tmp.make:
	if [ -d CVS ]; then \
	perl -e 'open(X,"cvs status -v versioninfo.c|"); $$ver = "";\
        while (($$_ = <X>) && (length($$ver) < 1)) { if (/Existing Tags/)\
                              {$$_ = <X>;  ($$x,$$ver) = split;};}\
	close(X); $$curver = ""; open(X,"versioninfo.c"); open(O,">tmp.make");\
        while (($$_ = <X>) && (length($$curver) < 5)) \
	{ s/VersionInfo="(.*)"/VersionInfo="$$ver"/; print O $$_;}\
	close(X);' ;\
	mv -f tmp.make versioninfo.c ;\
	fi
